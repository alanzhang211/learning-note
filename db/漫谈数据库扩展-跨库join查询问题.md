# 前言
之前，分享了数据库扩展的一些思路。针对不同的场景和性能需求，采取不同的策略。

读写分离为了分散数据库读写的压力；分库分表分散了存储的压力。然而，在解决问题的同时，引入了另外的一些问题：

1. 跨库的join查询问题。
2. 排序分页问题。
3. 自增id问题。
4. 分布式事务问题。

等等......

本篇开始，针对以上几个问题，进行归纳总结业界比较成熟的解决方案。欢迎交流分享～

首先，让我们看看第一个问题：跨裤join问题。

# 问题描述
跨库join，即需要将来源于不同的数据库表进行join关联。对于，单库而言，很方便。而且，业务系统也喜欢join表，省去查询多次的麻烦，一个大sql搞定。

当业务库进行分库分表后，面对头疼的问题及时消除这些“大sql”的join。转换为但表的查询，然后在应用系统进行内存join处理。

# 分析
## 存储引擎
跨库后，源来自于不同数据库实例。如果，不同数据库实例在同一台服务器上，可以用**数据库名.表名**来跨库join；如果在不同机器上，Mysql可以使用通过federated引擎链接远程表。

## 冗余字段
冗余字段是违反第三范式（3NF）要求一个数据库表中不包含已在其它表中已包含的非主关键字信息。

但在互联网行业是个比较常见的现象。就是以空间换时间的处理方式（冗余字段，增加了存储，减少数据库查询，特别是join操作）。

## 表同步
对于上面冗余字段是针对依赖字段较少的情况。如果依赖就多的话，可以考虑同步表的方式处理。把join中较小的数据集同步到其他表的节点上，类似于etl中的数据同步。不过这个适合更新频度不高的操作。

## 系统层组装
系统层同步分为2中，一种是应用体统自身；另一种就是借助数据库中间件。

**应用系统自身**，就是将大的join查询，分解为单表的查询。然后将符合条件的数据在应用系统进行合并整合。

**数据库中间件处理**，如：MyCAT（https://github.com/MyCATApache/Mycat-Server）。

![mycat](https://github.com/alanzhang211/learning-note/raw/master/img/db/MyCat.png)

具体细节可参考github，设计文档和资料比较齐全。fork了源码，后续好好分析一下，在做分享。

# 结束语
以上，就是今天简单的分享，跨库join问题的解决方案，欢迎留言。

---
本文开源至 https://github.com/alanzhang211/learning-note。 如果对您有帮助，欢迎star～提交issues。

（内容持续完善，敬请期待！）
